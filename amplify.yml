version: 1
backend:
  phases:
    preBuild:
      commands:
        - echo "{\"projectPath\":\"$(pwd)\",\"defaultEditor\":\"code\",\"envName\":\"dev\"}" > amplify/.config/local-env-info.json
    build:
      commands:
        - amplify push --yes --allow-destructive-graphql-schema-updates
  artifacts:
    baseDirectory: amplify
    files:
      - '**/*'
  cache:
    paths:
      - amplify/.config/local-env-info.json
      - amplify/backend/amplify-meta.json
frontend:
  phases:
    preBuild:
      commands:
        - npm install --prefix frontend
    build:
      commands:
        - npm run build --prefix frontend
  artifacts:
    baseDirectory: frontend/dist
    files:
      - '**/*'
  cache:
    paths:
      - frontend/node_modules/**/*
